<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book of Mormon Multi-Language Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { display: flex; justify-content: center; gap: 10px; }
        .pdf-container { width: 30%; height: 80vh; overflow-y: auto; border: 1px solid #ccc; min-height: 600px; position: relative; }
        canvas { width: 100%; display: block; }
        button { margin-top: 20px; padding: 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <h1>Book of Mormon Multi-Language Viewer</h1>
    
    <label for="language1">Select Language 1:</label>
    <select id="language1">
        <option value="BookOfMormonPDFs/English.pdf">English</option>
        <option value="BookOfMormonPDFs/Spanish.pdf">Spanish</option>
        <option value="BookOfMormonPDFs/Finnish.pdf">Finnish</option>
        <option value="BookOfMormonPDFs/Hawaiian.pdf">Hawaiian</option>
        <option value="BookOfMormonPDFs/Japanese.pdf">Japanese</option>
        <option value="BookOfMormonPDFs/German.pdf">German</option>
        <option value="BookOfMormonPDFs/Korean.pdf">Korean</option>
        <option value="BookOfMormonPDFs/Italian.pdf">Italian</option>
        <option value="BookOfMormonPDFs/Russian.pdf">Russian</option>
        <option value="BookOfMormonPDFs/Swedish.pdf">Swedish</option>
        <option value="BookOfMormonPDFs/Chinese(simplified).pdf">Chinese (Simplified)</option>
        <option value="BookOfMormonPDFs/Chinese(Traditional).pdf">Chinese (Traditional)</option>
        
    </select>
    
    <label for="language2">Select Language 2:</label>
    <select id="language2">
        <option value="BookOfMormonPDFs/English.pdf">English</option>
        <option value="BookOfMormonPDFs/Spanish.pdf">Spanish</option>
        <option value="BookOfMormonPDFs/Finnish.pdf">Finnish</option>
        <option value="BookOfMormonPDFs/Hawaiian.pdf">Hawaiian</option>
        <option value="BookOfMormonPDFs/Japanese.pdf">Japanese</option>
        <option value="BookOfMormonPDFs/German.pdf">German</option>
        <option value="BookOfMormonPDFs/Korean.pdf">Korean</option>
        <option value="BookOfMormonPDFs/Italian.pdf">Italian</option>
        <option value="BookOfMormonPDFs/Russian.pdf">Russian</option>
        <option value="BookOfMormonPDFs/Swedish.pdf">Swedish</option>
        <option value="BookOfMormonPDFs/Chinese(simplified).pdf">Chinese (Simplified)</option>
        <option value="BookOfMormonPDFs/Chinese(Traditional).pdf">Chinese (Traditional)</option>
        
    </select>
    
    <label for="language3">Select Language 3:</label>
    <select id="language3">
        <option value="BookOfMormonPDFs/English.pdf">English</option>
        <option value="BookOfMormonPDFs/Spanish.pdf">Spanish</option>
        <option value="BookOfMormonPDFs/Finnish.pdf">Finnish</option>
        <option value="BookOfMormonPDFs/Hawaiian.pdf">Hawaiian</option>
        <option value="BookOfMormonPDFs/Japanese.pdf">Japanese</option>
        <option value="BookOfMormonPDFs/German.pdf">German</option>
        <option value="BookOfMormonPDFs/Korean.pdf">Korean</option>
        <option value="BookOfMormonPDFs/Italian.pdf">Italian</option>
        <option value="BookOfMormonPDFs/Russian.pdf">Russian</option>
        <option value="BookOfMormonPDFs/Swedish.pdf">Swedish</option>
        <option value="BookOfMormonPDFs/Chinese(simplified).pdf">Chinese (Simplified)</option>
        <option value="BookOfMormonPDFs/Chinese(Traditional).pdf">Chinese (Traditional)</option>
        
    </select>
    
    <div id="pdfWrapper" class="container"></div>

    <button id="toggleScroll">Disable Synchronized Scrolling</button>
    
    <script>
        const pdfjsLib = window['pdfjsLib'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    
        // Render a single page on the given canvas
        function renderPage(canvas, pdf, pageNumber, callback) {
            pdf.getPage(pageNumber).then(function (page) {
                const scale = 1.5;
                const viewport = page.getViewport({ scale: scale });
    
                const context = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
    
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
    
                page.render(renderContext).promise.then(callback);
            });
        }
    
        // Lazy-load PDF rendering
        async function renderPDF(pdfURL, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear previous
    
            try {
                const loadingTask = pdfjsLib.getDocument(pdfURL);
                const pdf = await loadingTask.promise;
    
                const canvasElements = [];
    
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const canvas = document.createElement("canvas");
                    canvas.dataset.pageNumber = pageNum;
                    canvas.style.minHeight = "100px"; // Reserve space
                    canvasElements.push(canvas);
                    container.appendChild(canvas);
                }
    
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const canvas = entry.target;
                            const pageNumber = parseInt(canvas.dataset.pageNumber);
    
                            if (!canvas.dataset.rendered) {
                                canvas.dataset.rendered = "true";
                                renderPage(canvas, pdf, pageNumber, () => {
                                    // Optional callback
                                    // console.log(`Page ${pageNumber} rendered`);
                                });
                            }
                        }
                    });
                }, {
                    root: container,
                    rootMargin: "200px", // Preload before it scrolls into view
                    threshold: 0.1
                });
    
                canvasElements.forEach(canvas => observer.observe(canvas));
            } catch (error) {
                console.error("Error loading PDF:", error);
                container.innerHTML = '<p style="color: red;">Failed to load PDF.</p>';
            }
        }
    
        function rebuildContainers() {
            let wrapper = document.getElementById('pdfWrapper');
            wrapper.innerHTML = '';
    
            for (let i = 1; i <= 3; i++) {
                let container = document.createElement("div");
                container.id = `pdfContainer${i}`;
                container.className = "pdf-container";
                wrapper.appendChild(container);
            }
        }
    
        function updatePDFs() {
            rebuildContainers();
    
            renderPDF(document.getElementById('language1').value, 'pdfContainer1');
            renderPDF(document.getElementById('language2').value, 'pdfContainer2');
            renderPDF(document.getElementById('language3').value, 'pdfContainer3');
    
            setupScrollSync();
        }
    
        document.getElementById('language1').addEventListener('change', updatePDFs);
        document.getElementById('language2').addEventListener('change', updatePDFs);
        document.getElementById('language3').addEventListener('change', updatePDFs);
    
        window.onload = updatePDFs;
    
        // Scroll synchronization logic
        let isSyncing = true;
    
        function syncScroll(event) {
            if (!isSyncing) return;
            let scrollTop = event.target.scrollTop;
            document.querySelectorAll('.pdf-container').forEach(container => {
                if (container !== event.target) {
                    container.scrollTop = scrollTop;
                }
            });
        }
    
        function setupScrollSync() {
            document.querySelectorAll('.pdf-container').forEach(container => {
                container.removeEventListener('scroll', syncScroll);
                container.addEventListener('scroll', syncScroll);
            });
        }
    
        document.getElementById('toggleScroll').addEventListener('click', function () {
            isSyncing = !isSyncing;
            this.textContent = isSyncing ? 'Disable Synchronized Scrolling' : 'Enable Synchronized Scrolling';
        });
    </script>
     
</body>
</html>
